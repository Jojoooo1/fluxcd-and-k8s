apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: staging
nameSuffix: -staging

commonLabels:
    env: staging


resources:
  - common/namespace.yaml
  - common/rbac.yaml

bases:
  - ../../bases/services/java-demo
patchesStrategicMerge:
  - java-demo/backend/deployment-patch.yaml
  - java-demo/database/deployment-patch.yaml

# Workaround the fact that namePrefix / nameSuffix also adds a prefix to the base namespace. Issue: https://github.com/kubernetes-sigs/kustomize/issues/235#issuecomment-522887625. Workaround: https://github.com/kubernetes-sigs/kustomize/issues/235#issuecomment-430197657
patchesJson6902:
- target:
    version: v1
    kind: Namespace
    name: staging
  path: common/namespace.yaml