---
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: prometheus
  namespace: monitoring-system
  annotations:
    fluxcd.io/automated: "false" # do not update automatically to prevent damaging the system

spec:
  chart:
    values:
      # https://github.com/helm/charts/tree/master/stable/prometheus-operator#configuration
      
      ## Deployed PrometheusOperator instance Spec ##
      # CRD are created through kustomize (helm does not handle well CRD creation)
      prometheusOperator:
        createCustomResource: false

      ## Deployed Prometheus instance Spec ##
      prometheus:
        prometheusSpec:
          retention: "14d"
          resources: {} # limit
          #  storageSpec:
          volumeClaimTemplate:
            metadata:
              name: prometheus-pvc
              namespace: monitoring-system
            spec:
              volumeName: prometheus-pv
              accessModes: ["ReadWriteOnce"]
              requests:
                storage: 10Mi
      
      ## Deployed Grafana instance Spec ##
      grafana:
        adminPassword: password
        persistence:
          enabled: true
          type: pvc
          existingClaim: grafana-pvc


      ## Deployed AlertManager instance Spec ##
      alertmanager:
        alertmanagerSpec:
          retention: "120h"
          resources: {} # limit
          #  storageSpec:
          volumeClaimTemplate:
            metadata:
              name: alertmanager-pvc
              namespace: monitoring-system
            spec:
              volumeName: alertmanager-pv
              accessModes: ["ReadWriteOnce"]
              requests:
                storage: 10Mi

      # Disable Etcd metrics
      kubeEtcd.enabled: false
      # Disable Controller metrics
      kubeControllerManager.enabled: false
      # Disable Scheduler metrics
      kubeScheduler.enabled: false



