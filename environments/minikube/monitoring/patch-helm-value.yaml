---
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: prometheus
  namespace: monitoring-system
  annotations:
    fluxcd.io/automated: "false" # do not update automatically to prevent damaging the system

spec:
  chart:
    values:
      # https://github.com/helm/charts/tree/master/stable/prometheus-operator#configuration
      # fullnameOverride: prometheus
      
      ## Deployed PrometheusOperator instance Spec ##
      # CRD are created through kustomize (helm does not handle well CRD creation)
      prometheusOperator.createCustomResource: false

      ## Deployed Prometheus instance Spec ##
      prometheus.prometheusSpec.retention: "14d"
      prometheus.prometheusSpec.resources: {} # limit

      prometheus.prometheusSpec.storageSpec.volumeClaimTemplate.metadata.name: prometheus-pvc
      prometheus.prometheusSpec.storageSpec.volumeClaimTemplate.metadata.namespace: monitoring-system
      prometheus.prometheusSpec.storageSpec.volumeClaimTemplate.spec.volumeName: prometheus-pv

      ## Deployed Grafana instance Spec ##
      grafana.persistence.enabled: true
      grafana.persistence.type: pvc
      grafana.persistence.existingClaim: grafana-pvc
      grafana.adminPassword: password


      ## Deployed AlertManager instance Spec ##
      alertmanager.alertmanagerSpec.storage.volumeClaimTemplate.metadata.name: alertmanager-pvc
      alertmanager.alertmanagerSpec.storage.volumeClaimTemplate.metadata.namespace: monitoring-system
      alertmanager.alertmanagerSpec.storage.volumeClaimTemplate.spec.volumeName: alertmanager-pv
      alertmanager.alertmanagerSpec.retention: 120h

      # Disable Etcd metrics
      kubeEtcd.enabled: false
      # Disable Controller metrics
      kubeControllerManager.enabled: false
      # Disable Scheduler metrics
      kubeScheduler.enabled: false



